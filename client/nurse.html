<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MESMTF ‚Äî Nurse Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .fade-in { animation: fadeIn .3s ease-in; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(6px);} to {opacity:1; transform:translateY(0);} }
    .pill { display:inline-block; padding:.25rem .6rem; border-radius:999px; background:#eef2ff; color:#312e81; font-size:.8rem; }
    .small { font-size:.85rem; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans">

  <!-- Top nav -->
  <header class="bg-white shadow">
    <div class="max-w-7xl mx-auto flex items-center justify-between p-4">
      <div class="flex items-center space-x-4">
        <div class="rounded-full bg-green-600 w-12 h-12 flex items-center justify-center text-white font-bold">N</div>
        <div>
          <div class="text-lg font-bold text-gray-800">MESMTF Nurse Portal</div>
          <div class="text-sm text-gray-500">Medical Expert System ‚Äî Malaria & Typhoid</div>
        </div>
      </div>
      <div class="flex items-center space-x-4">
        <div class="text-sm text-gray-700">Nurse Jane ‚Ä¢ <span class="text-xs text-gray-500">Nurse</span></div>
        <button id="logoutBtn" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded">Logout</button>
      </div>
    </div>
  </header>

  <div class="max-w-7xl mx-auto mt-6 flex gap-6 px-4">
    <!-- Sidebar -->
    <aside class="w-72 bg-white rounded-lg shadow p-4 sticky top-6 h-[calc(100vh-96px)]">
      <nav class="space-y-1">
        <button id="nav-dashboard" class="w-full text-left px-3 py-2 rounded hover:bg-gray-50" onclick="render('dashboard')">üè† Dashboard</button>
        <button id="nav-patients" class="w-full text-left px-3 py-2 rounded hover:bg-gray-50" onclick="render('patients')">üë• Patients Under Care</button>
        <button id="nav-vitals" class="w-full text-left px-3 py-2 rounded hover:bg-gray-50" onclick="render('vitals')">ü©∫ Record Vitals</button>
        <button id="nav-drugs" class="w-full text-left px-3 py-2 rounded hover:bg-gray-50" onclick="render('drugs')">üíâ Drug Administration</button>
        <button id="nav-reports" class="w-full text-left px-3 py-2 rounded hover:bg-gray-50" onclick="render('reports')">üìä Reports</button>
      </nav>
    </aside>

    <!-- Main content -->
    <main id="mainContent" class="flex-1 min-h-[70vh] bg-white rounded-lg shadow p-6 fade-in">
    </main>
  </div>

  <script>
  // -------------------------
  // Data
  // -------------------------
  let patients = JSON.parse(localStorage.getItem('nurse_patients')) || [
    { id:'p1', name:'John Doe', condition:'Malaria', room:'101A' },
    { id:'p2', name:'Jane Smith', condition:'Typhoid', room:'102B' }
  ];
  let vitals = JSON.parse(localStorage.getItem('nurse_vitals')) || [];
  let drugAdmin = JSON.parse(localStorage.getItem('nurse_drugs')) || [
    { id:'d1', patientId:'p1', patientName:'John Doe', drug:'Paracetamol 500mg', time:'2025-09-23T09:00', status:'pending' },
    { id:'d2', patientId:'p2', patientName:'Jane Smith', drug:'Ciprofloxacin 250mg', time:'2025-09-23T10:00', status:'pending' }
  ];
  function save(){ localStorage.setItem('nurse_patients', JSON.stringify(patients)); localStorage.setItem('nurse_vitals', JSON.stringify(vitals)); localStorage.setItem('nurse_drugs', JSON.stringify(drugAdmin)); }

  function uid(prefix){ return prefix+'-'+Math.floor(Date.now()+Math.random()*1000); }
  function fmtDate(d){ return new Date(d).toLocaleString(); }

  // -------------------------
  // Dashboard
  // -------------------------
  function renderDashboard(){
    document.getElementById('mainContent').innerHTML = `
      <h2 class="text-2xl font-bold mb-4">Nurse Dashboard</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-white p-4 rounded shadow"><h3 class="text-sm text-gray-500">Patients Under Care</h3><div class="text-lg font-semibold mt-2">${patients.length}</div></div>
        <div class="bg-white p-4 rounded shadow"><h3 class="text-sm text-gray-500">Vitals Recorded</h3><div class="text-lg font-semibold mt-2">${vitals.length}</div></div>
        <div class="bg-white p-4 rounded shadow"><h3 class="text-sm text-gray-500">Pending Drug Admin</h3><div class="text-lg font-semibold mt-2">${drugAdmin.filter(d=>d.status==='pending').length}</div></div>
      </div>
    `;
  }

  // -------------------------
  // Patients
  // -------------------------
  function renderPatients(){
    document.getElementById('mainContent').innerHTML = `
      <h2 class="text-2xl font-bold mb-4">Patients Under Care</h2>
      <div class="space-y-3">
        ${patients.map(p=>`
          <div class="p-3 border rounded flex justify-between">
            <div>
              <div class="font-semibold">${p.name}</div>
              <div class="text-sm text-gray-500">${p.condition} ‚Ä¢ Room ${p.room}</div>
            </div>
            <button class="px-3 py-1 bg-blue-600 text-white rounded" onclick="openVitalsForm('${p.id}')">Record Vitals</button>
          </div>
        `).join('')}
      </div>
    `;
  }

  // -------------------------
  // Vitals
  // -------------------------
  function renderVitals(){
    document.getElementById('mainContent').innerHTML = `
      <h2 class="text-2xl font-bold mb-4">Record Vital Signs</h2>
      <form id="vitalsForm" class="space-y-2 bg-white p-4 rounded shadow max-w-md">
        <label class="small">Patient</label>
        <select id="vPatient" class="w-full p-2 border rounded">
          ${patients.map(p=>`<option value="${p.id}">${p.name}</option>`).join('')}
        </select>
        <input id="vTemp" placeholder="Temperature (¬∞C)" class="w-full p-2 border rounded" />
        <input id="vBP" placeholder="Blood Pressure" class="w-full p-2 border rounded" />
        <input id="vHR" placeholder="Heart Rate (bpm)" class="w-full p-2 border rounded" />
        <input id="vResp" placeholder="Respiration Rate" class="w-full p-2 border rounded" />
        <textarea id="vNotes" placeholder="Notes" class="w-full p-2 border rounded"></textarea>
        <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded">Save Vitals</button>
      </form>
      <div class="mt-6">
        <h3 class="font-semibold mb-2">Recent Vitals</h3>
        <div id="vitalsList" class="space-y-2 max-h-[40vh] overflow-y-auto"></div>
      </div>
    `;
    refreshVitalsList();

    document.getElementById('vitalsForm').onsubmit = (e)=>{
      e.preventDefault();
      const pid=document.getElementById('vPatient').value;
      const pat=patients.find(x=>x.id===pid);
      const entry={ id:uid('v'), patientId:pid, patientName:pat.name, temp:document.getElementById('vTemp').value, bp:document.getElementById('vBP').value, hr:document.getElementById('vHR').value, resp:document.getElementById('vResp').value, notes:document.getElementById('vNotes').value, time:new Date().toISOString() };
      vitals.unshift(entry);
      save();
      refreshVitalsList();
      alert('Vitals saved');
    };
  }

  function refreshVitalsList(){
    const list=document.getElementById('vitalsList');
    if(!list) return;
    list.innerHTML=vitals.map(v=>`
      <div class="p-2 border rounded">
        <div class="font-semibold">${v.patientName}</div>
        <div class="text-xs text-gray-500">${fmtDate(v.time)}</div>
        <div class="text-xs">Temp: ${v.temp}¬∞C ‚Ä¢ BP: ${v.bp} ‚Ä¢ HR: ${v.hr} ‚Ä¢ RR: ${v.resp}</div>
        <div class="text-xs text-gray-600">${v.notes||''}</div>
      </div>
    `).join('');
  }

  function openVitalsForm(pid){
    renderVitals();
    document.getElementById('vPatient').value=pid;
  }

  // -------------------------
  // Drug Administration
  // -------------------------
  function renderDrugs(){
    document.getElementById('mainContent').innerHTML=`
      <h2 class="text-2xl font-bold mb-4">Drug Administration</h2>
      <div class="space-y-3">
        ${drugAdmin.map(d=>`
          <div class="p-3 border rounded flex justify-between">
            <div>
              <div class="font-semibold">${d.patientName}</div>
              <div class="text-sm">${d.drug}</div>
              <div class="text-xs text-gray-500">Scheduled: ${fmtDate(d.time)}</div>
              <div class="text-xs">Status: <span class="pill">${d.status}</span></div>
            </div>
            ${d.status==='pending' ? `<button class="px-3 py-1 bg-green-600 text-white rounded" onclick="markAdmin('${d.id}')">Administer</button>`:''}
          </div>
        `).join('')}
      </div>
    `;
  }

  function markAdmin(id){
    drugAdmin=drugAdmin.map(d=>d.id===id?{...d,status:'administered',time:new Date().toISOString()}:d);
    save();
    render('drugs');
  }

  // -------------------------
  // Reports
  // -------------------------
  function renderReports(){
    const totalVitals=vitals.length;
    const totalDrugs=drugAdmin.length;
    const administered=drugAdmin.filter(d=>d.status==='administered').length;
    document.getElementById('mainContent').innerHTML=`
      <h2 class="text-2xl font-bold mb-4">Reports</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-white p-4 rounded shadow">Vitals Recorded: <strong>${totalVitals}</strong></div>
        <div class="bg-white p-4 rounded shadow">Drugs Administered: <strong>${administered}</strong></div>
        <div class="bg-white p-4 rounded shadow">Total Prescriptions: <strong>${totalDrugs}</strong></div>
      </div>
    `;
  }

  // -------------------------
  // Dispatcher
  // -------------------------
  function render(page){
    switch(page){
      case 'dashboard': renderDashboard(); break;
      case 'patients': renderPatients(); break;
      case 'vitals': renderVitals(); break;
      case 'drugs': renderDrugs(); break;
      case 'reports': renderReports(); break;
      default: renderDashboard();
    }
    highlightNav(page);
  }

  function highlightNav(page){
    ['nav-dashboard','nav-patients','nav-vitals','nav-drugs','nav-reports'].forEach(id=>{
      const el=document.getElementById(id); if(el) el.classList.remove('bg-gray-100','font-semibold');
    });
    switch(page){
      case 'dashboard': document.getElementById('nav-dashboard').classList.add('bg-gray-100','font-semibold'); break;
      case 'patients': document.getElementById('nav-patients').classList.add('bg-gray-100','font-semibold'); break;
      case 'vitals': document.getElementById('nav-vitals').classList.add('bg-gray-100','font-semibold'); break;
      case 'drugs': document.getElementById('nav-drugs').classList.add('bg-gray-100','font-semibold'); break;
      case 'reports': document.getElementById('nav-reports').classList.add('bg-gray-100','font-semibold'); break;
    }
  }

  // init
 render('dashboard');
  document.getElementById('logoutBtn').onclick=()=>{ if(confirm('Logout?')) window.location.href = 'index.html'; };

  // expose
  window.render=render;
  window.openVitalsForm=openVitalsForm;
  window.markAdmin=markAdmin;
  </script>
</body>
</html>
